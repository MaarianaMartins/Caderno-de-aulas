{"title":"Aula 8- transformações, ANOVA e teste de média","markdown":{"yaml":{"title":"Aula 8- transformações, ANOVA e teste de média","format":"html","editor_options":{"chunk_output_type":"console"}},"headingText":"ANOVA com blocos casualizados","containsRefs":false,"markdown":"\n\n\n## Importa dados\n\nPara cada variável-resposta será feito um ANOVA. Modificar o ANOVA para considerar o bloco como efeito fixo Temos que modificar o número do tratamento e os números do bloco como fatores.\n\n```{r}\n#theme_set(theme_bw())\nlibrary(tidyverse)\nlibrary(gsheet)\n\nsoja <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n\nsoja <- soja |> \n  mutate(TRAT = as.factor(TRAT),\n         BLOCO = as.factor(BLOCO))\n```\n\n##Visualizar Gráfico 1 para a variavel DFC Gráfico 2 para a variavel FER Grafico 3 para a variavel PROD\n\n```{r}\ndfc <- soja |> \n  ggplot(aes(TRAT, DFC))+\n  geom_jitter(width = 0.05, color = \"gray70\")+\n  stat_summary(fun.data = \"mean_cl_boot\", color = \"black\") #A bola preta representa a média e a linha o intervalo de confiança\ndfc\n\nfer <- soja |> \n  ggplot(aes(TRAT, FER))+\n  geom_jitter(width = 0.1)\nfer\n\nprod <- soja |> \n  ggplot(aes(TRAT, PROD))+\n  geom_jitter(width = 0.1)\nprod\n\nlibrary(patchwork)\ndfc / fer / prod\n```\n\n## ANOVA DFC\n\nPvalor indicando com \\*\\*\\* e o valor super baixo, indiccando que o efeito do tratamento é extremamente significativo. Para blocos, não foi significativo. Pode seguir as análises por que pelo menos uma das médias difere uma da outra, agora temos que saber se podemos confiar na anova e testar as suas premissas de normalidade e homosdasticidade.\n\n```{r}\naov_dfc <- lm(DFC ~ TRAT+BLOCO,  #Bloco entra como efeito fixo ao colocar o \"+\"\n              data = soja)\nanova(aov_dfc)\n#Grau de liberdade = n-1\n#F é a divisão entre os Mean Square\n# Trat é extremamente significativo\n\nlibrary(performance)\ncheck_heteroscedasticity(aov_dfc)\ncheck_normality(aov_dfc)\n\nlibrary(emmeans)\nmedias_dfc <- emmeans(aov_dfc, ~ TRAT)\nmedias_dfc\npwpm(medias_dfc)\n\nlibrary(multcomp)\nlibrary(multcompView)\ncld(medias_dfc, Letters = letters)\n\n\n#Eficácia no controle (%) = (1- (emmean do tratamento/emmean da testemunha))*100\n\n```\n\n## ANOVA FER\n\n```{r}\naov_fer <- lm(FER ~ TRAT+BLOCO,\n              data = soja)\nanova(aov_fer)\n\nlibrary(performance)\ncheck_heteroscedasticity(aov_fer) #Variância não é homogênea\ncheck_normality(aov_fer) #Não há normalidade\n\n#Transformação dos dados\nsoja <- soja |> \n  mutate(FER2 = log(FER))\n\naov_fer2 <- lm(FER2 ~ TRAT+BLOCO,\n               data = soja)\nanova(aov_fer2)\ncheck_normality(aov_fer2)\ncheck_heteroscedasticity(aov_fer2) #Ainda não é homogêneo, mas iremos considerar como homogêneo\n\nmedias_fer <- emmeans(aov_fer2, ~ TRAT)\nmedias_fer\npwpm(medias_fer)\n\ncld(medias_fer, Letters = letters)\n\n#Tentando arrumar a normalidade por Lambda\nb <- boxcox(lm(soja$FER ~ 1))\nlambda <- b$x[which.max(b$y)]\nlambda\nsoja$FER3 <- (soja$FER ^ lambda - 1)/ lambda\naov_fer3 <- lm(FER3 ~ TRAT+BLOCO,\n              data = soja)\ncheck_normality(aov_fer3)\ncheck_heteroscedasticity(aov_fer3)\nmedias_fer2 <- emmeans(aov_fer2, ~ TRAT)\nmedias_fer2\npwpm(medias_fer2)\n\ncld(medias_fer2, Letters = letters)\n```\n\nCom os resultados do CLD pode-se fazer uma tabela com as médias e as letrinhas, também o intervalo de confiança e pode omitir o erro padrão... Ou então uma tabelta mais larga com as 3 variaveis, ou então usar um gráfico e colocar as letras nele. Nunca mostrar a tabela e o gráfico, ai é redundância. \\## ANOVA PROD\n\n```{r}\naov_prod <- lm(PROD ~ TRAT+BLOCO,\n              data = soja)\nanova(aov_prod)\ncheck_heteroscedasticity(aov_prod) #Variância é homogênea\ncheck_normality(aov_prod) #Há normalidade\n\nmedias_prod <- emmeans(aov_prod, ~ TRAT)\nmedias_prod\npwpm(medias_prod)\ncld(medias_prod, Letters = letters)\nmedias_prod_grupo <- cld(medias_prod, Letters = letters)\n\n```\n\nOutra forma de visualizar os valores da produtividade\n\n```{r}\ndf_prod <- data.frame(medias_prod_grupo)\ndf_prod |> \n  ggplot(aes(TRAT, emmean))+\n  geom_point()+\n  ylim(3000,6500)+\n  geom_errorbar(aes(min = lower.CL,\n                    max = upper.CL),\n                width = 0.1)+\n  annotate(geom = \"text\", x = 1.1, y = 4200, label = \"A\")+\n  annotate(geom = \"text\", x = 2.1, y = 5000, label = \"AB\")\n\nknitr::kable(df_prod |> dplyr::select(TRAT, emmean, .group))\nlibrary(writexl)\nwrite_xlsx(df_prod, \"df.xlsx\")\n\n#Diferença de produtividade = emmean do tratamento - emmean da testemunha\n\n```\n\nSe quiser colocar as letrinhas, tem que usar o anotate e fazer a \"colocação\" manualmente. Os dados 1 e 6 não tem overleap do intervlao de confiança, já os que tem o overleap ex 1 e 5 estão no mesmo grupo e não diferem estatisticamente. É uma maneira visual de determinar a diferença e fazer o leitor entender.\n\n# Novos dados Curve\n\n```{r}\ntheme_set(theme_bw())\ncurve <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1807247585\")\ncurve = as.data.frame(curve)\n\n\ncurve |> \n  group_by(day) |> \n  summarise(severity_mean = mean(severity),\n            severity_sd = sd(severity)) |> \n  ggplot(aes(day, severity_mean))+\n  geom_point(width = 0.05)+\n  geom_line()\n\ncurve |> \n  group_by(day, Irrigation) |> \n  summarise(severity_mean = mean(severity),\n            severity_sd = sd(severity)) |> \n  ggplot(aes(day, severity_mean, color = Irrigation))+\n  geom_point(width = 0.05)+\n  geom_line()\n\ncurve |> \n  group_by(day, Irrigation) |> \n  summarise(severity_mean = mean(severity)) |> \n  ggplot(aes(day, severity_mean))+\n  geom_point(width = 0.05)+\n  geom_line()+\n  facet_grid(~Irrigation)\n\n#Área abaixo da curva\nlibrary(epifitter)\naudpc <- curve |> \n  group_by(Irrigation, rep) |> \n  summarise(aacpd = AUDPC(day, severity))\n\n#ANOVA da área debaixo da curva\naov_audpc <- lm(aacpd ~ Irrigation + factor(rep),\n                data = audpc) \nanova(aov_audpc)\n  \naov_curve <- lm(severity ~ Irrigation*day + rep,\n         data = curve)\nanova(aov_curve)\n\nlibrary(agricolae)\ncv.model(aov_audpc) #coeficiente de variação, que é o desvio padrão dividido por 100\n\n```\n","srcMarkdownNoYaml":"\n\n# ANOVA com blocos casualizados\n\n## Importa dados\n\nPara cada variável-resposta será feito um ANOVA. Modificar o ANOVA para considerar o bloco como efeito fixo Temos que modificar o número do tratamento e os números do bloco como fatores.\n\n```{r}\n#theme_set(theme_bw())\nlibrary(tidyverse)\nlibrary(gsheet)\n\nsoja <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n\nsoja <- soja |> \n  mutate(TRAT = as.factor(TRAT),\n         BLOCO = as.factor(BLOCO))\n```\n\n##Visualizar Gráfico 1 para a variavel DFC Gráfico 2 para a variavel FER Grafico 3 para a variavel PROD\n\n```{r}\ndfc <- soja |> \n  ggplot(aes(TRAT, DFC))+\n  geom_jitter(width = 0.05, color = \"gray70\")+\n  stat_summary(fun.data = \"mean_cl_boot\", color = \"black\") #A bola preta representa a média e a linha o intervalo de confiança\ndfc\n\nfer <- soja |> \n  ggplot(aes(TRAT, FER))+\n  geom_jitter(width = 0.1)\nfer\n\nprod <- soja |> \n  ggplot(aes(TRAT, PROD))+\n  geom_jitter(width = 0.1)\nprod\n\nlibrary(patchwork)\ndfc / fer / prod\n```\n\n## ANOVA DFC\n\nPvalor indicando com \\*\\*\\* e o valor super baixo, indiccando que o efeito do tratamento é extremamente significativo. Para blocos, não foi significativo. Pode seguir as análises por que pelo menos uma das médias difere uma da outra, agora temos que saber se podemos confiar na anova e testar as suas premissas de normalidade e homosdasticidade.\n\n```{r}\naov_dfc <- lm(DFC ~ TRAT+BLOCO,  #Bloco entra como efeito fixo ao colocar o \"+\"\n              data = soja)\nanova(aov_dfc)\n#Grau de liberdade = n-1\n#F é a divisão entre os Mean Square\n# Trat é extremamente significativo\n\nlibrary(performance)\ncheck_heteroscedasticity(aov_dfc)\ncheck_normality(aov_dfc)\n\nlibrary(emmeans)\nmedias_dfc <- emmeans(aov_dfc, ~ TRAT)\nmedias_dfc\npwpm(medias_dfc)\n\nlibrary(multcomp)\nlibrary(multcompView)\ncld(medias_dfc, Letters = letters)\n\n\n#Eficácia no controle (%) = (1- (emmean do tratamento/emmean da testemunha))*100\n\n```\n\n## ANOVA FER\n\n```{r}\naov_fer <- lm(FER ~ TRAT+BLOCO,\n              data = soja)\nanova(aov_fer)\n\nlibrary(performance)\ncheck_heteroscedasticity(aov_fer) #Variância não é homogênea\ncheck_normality(aov_fer) #Não há normalidade\n\n#Transformação dos dados\nsoja <- soja |> \n  mutate(FER2 = log(FER))\n\naov_fer2 <- lm(FER2 ~ TRAT+BLOCO,\n               data = soja)\nanova(aov_fer2)\ncheck_normality(aov_fer2)\ncheck_heteroscedasticity(aov_fer2) #Ainda não é homogêneo, mas iremos considerar como homogêneo\n\nmedias_fer <- emmeans(aov_fer2, ~ TRAT)\nmedias_fer\npwpm(medias_fer)\n\ncld(medias_fer, Letters = letters)\n\n#Tentando arrumar a normalidade por Lambda\nb <- boxcox(lm(soja$FER ~ 1))\nlambda <- b$x[which.max(b$y)]\nlambda\nsoja$FER3 <- (soja$FER ^ lambda - 1)/ lambda\naov_fer3 <- lm(FER3 ~ TRAT+BLOCO,\n              data = soja)\ncheck_normality(aov_fer3)\ncheck_heteroscedasticity(aov_fer3)\nmedias_fer2 <- emmeans(aov_fer2, ~ TRAT)\nmedias_fer2\npwpm(medias_fer2)\n\ncld(medias_fer2, Letters = letters)\n```\n\nCom os resultados do CLD pode-se fazer uma tabela com as médias e as letrinhas, também o intervalo de confiança e pode omitir o erro padrão... Ou então uma tabelta mais larga com as 3 variaveis, ou então usar um gráfico e colocar as letras nele. Nunca mostrar a tabela e o gráfico, ai é redundância. \\## ANOVA PROD\n\n```{r}\naov_prod <- lm(PROD ~ TRAT+BLOCO,\n              data = soja)\nanova(aov_prod)\ncheck_heteroscedasticity(aov_prod) #Variância é homogênea\ncheck_normality(aov_prod) #Há normalidade\n\nmedias_prod <- emmeans(aov_prod, ~ TRAT)\nmedias_prod\npwpm(medias_prod)\ncld(medias_prod, Letters = letters)\nmedias_prod_grupo <- cld(medias_prod, Letters = letters)\n\n```\n\nOutra forma de visualizar os valores da produtividade\n\n```{r}\ndf_prod <- data.frame(medias_prod_grupo)\ndf_prod |> \n  ggplot(aes(TRAT, emmean))+\n  geom_point()+\n  ylim(3000,6500)+\n  geom_errorbar(aes(min = lower.CL,\n                    max = upper.CL),\n                width = 0.1)+\n  annotate(geom = \"text\", x = 1.1, y = 4200, label = \"A\")+\n  annotate(geom = \"text\", x = 2.1, y = 5000, label = \"AB\")\n\nknitr::kable(df_prod |> dplyr::select(TRAT, emmean, .group))\nlibrary(writexl)\nwrite_xlsx(df_prod, \"df.xlsx\")\n\n#Diferença de produtividade = emmean do tratamento - emmean da testemunha\n\n```\n\nSe quiser colocar as letrinhas, tem que usar o anotate e fazer a \"colocação\" manualmente. Os dados 1 e 6 não tem overleap do intervlao de confiança, já os que tem o overleap ex 1 e 5 estão no mesmo grupo e não diferem estatisticamente. É uma maneira visual de determinar a diferença e fazer o leitor entender.\n\n# Novos dados Curve\n\n```{r}\ntheme_set(theme_bw())\ncurve <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1807247585\")\ncurve = as.data.frame(curve)\n\n\ncurve |> \n  group_by(day) |> \n  summarise(severity_mean = mean(severity),\n            severity_sd = sd(severity)) |> \n  ggplot(aes(day, severity_mean))+\n  geom_point(width = 0.05)+\n  geom_line()\n\ncurve |> \n  group_by(day, Irrigation) |> \n  summarise(severity_mean = mean(severity),\n            severity_sd = sd(severity)) |> \n  ggplot(aes(day, severity_mean, color = Irrigation))+\n  geom_point(width = 0.05)+\n  geom_line()\n\ncurve |> \n  group_by(day, Irrigation) |> \n  summarise(severity_mean = mean(severity)) |> \n  ggplot(aes(day, severity_mean))+\n  geom_point(width = 0.05)+\n  geom_line()+\n  facet_grid(~Irrigation)\n\n#Área abaixo da curva\nlibrary(epifitter)\naudpc <- curve |> \n  group_by(Irrigation, rep) |> \n  summarise(aacpd = AUDPC(day, severity))\n\n#ANOVA da área debaixo da curva\naov_audpc <- lm(aacpd ~ Irrigation + factor(rep),\n                data = audpc) \nanova(aov_audpc)\n  \naov_curve <- lm(severity ~ Irrigation*day + rep,\n         data = curve)\nanova(aov_curve)\n\nlibrary(agricolae)\ncv.model(aov_audpc) #coeficiente de variação, que é o desvio padrão dividido por 100\n\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Aula8_quarto.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","editor":"visual","theme":"solar","title":"Aula 8- transformações, ANOVA e teste de média","editor_options":{"chunk_output_type":"console"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}