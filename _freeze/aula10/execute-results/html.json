{
  "hash": "b715163d431582ea891381eec8d66251",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Análise de correlação\"\nformat: html\neditor: visual\nmessage: false \nwarning: false\n---\n\n\n## Aula 10\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"AgroR\")\n```\n:::\n\n\nA correlação é uma relação entre duas ou mais variáveis. Existe uma direção dessa associação, que pode ser forte ou fraca. Ela pode ser linear e positiva. A força da associação está relacionada com a dispersão dos dados, quanto mais disperso os dados mais fraca é a asociação. Então, um dos coeficientes que pode estimar isso é o coeficiente de correlação de Pearson. Quanto mais disperso, mais próximo de zero fica o coeficiente. Ela pode ser negativa quando uma varíaveld diminui em função da outra (ex: produtividade x doença), existindo uma relação de causa/efeito. É usada quando você obtém respostas diferentes e que analisar se existe uma correlação entre as variaveis respostas. Pode ser feita regressão quando o objetivo é predizer y em função de x. Pode chegar em um coeficiente de correlação através de uma análise de regressão, o quanto que a variação de y é explicada pelo x.\n\nR2 = o quanto da variação de y é explicada pelo x R= a força de associação\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gsheet)\nimgs <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=373270992\")\n\nimgs |> \n  pivot_longer(3:5, names_to = \"method\", \n               values_to = \"value\") |> \n  ggplot(aes(method, value)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nimgs1 <- imgs |> \n  ggplot(aes(Assess, LeafDoctor)) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\nimgs1\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nimgs2 <- imgs |>\n  ggplot(aes(Assess, ImageJ)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") \nimgs2\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(patchwork)\nimgs1 + imgs2\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-2-4.png){width=672}\n:::\n:::\n\n\nEle faz uma matriz de correlação Cor entrega o coeficiente de correlação de pearson. O cor test da uma estatística mais completa. 0,96 é bem próximo de um, então indica uma correlação forte. Quanto maior a correlação menor o p-valor, se os dados forem mais dispersos o p-valor vai ser maior e não vai ser significativo. O corgraph é um pacote que indica a correlação entre as respostas da análise. Os valores dentro da matriz irão indicar o coeficiente de correlação entre as varíaveis observadas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimgs3 <- imgs |> \n  select(3:5)\n  \nlibrary(AgroR)\ncorgraph(imgs3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Var1       Var2       cor            p\n2 LeafDoctor     Assess 0.9666367 5.972544e-42\n3     ImageJ     Assess 0.9776918 8.143613e-48\n6     ImageJ LeafDoctor 0.9797478 3.144091e-49\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor.test(imgs$Assess, imgs$LeafDoctor)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  imgs$Assess and imgs$LeafDoctor\nt = 31.119, df = 68, p-value < 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.9466882 0.9792005\nsample estimates:\n      cor \n0.9666367 \n```\n\n\n:::\n\n```{.r .cell-code}\ncor(imgs$Assess, imgs$LeafDoctor)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.9666367\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(corrplot)\ncor_imgs2 <- cor(imgs3) \ncorrplot(cor_imgs2, method = \"number\", type = \"lower\", diag = FALSE) \n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\ncampo2 <- campo |> \n  select (DFC, FER, PROD)\nlibrary(AgroR)\ncorgraph(campo2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Var1 Var2        cor            p\n2  FER  DFC  0.9316978 9.864101e-15\n3 PROD  DFC -0.6928161 1.110652e-05\n6 PROD  FER -0.6258321 1.277444e-04\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncampo |>\n  ggplot(aes(DFC, PROD)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\nO modelo quadratico é um experimento melhor do que o de primeira ordem, explica melhor o que vemos no gráfico anterior e a variação dos desvios. Pode ser utilizado essa variação, predizer o numero de plantas afetadas. y = (66,3 - 1,77*trat) + (0,02*trat\\^2) : equação do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n\nestande |>\n  ggplot(aes(trat, nplants, color = factor (exp))) +\n  geom_boxplot() +\n  facet_wrap(~ exp) +\n  theme_bw() +\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5,\n               color = \"black\")\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nestande |>\n  ggplot(aes(trat, nplants, color = factor (exp))) +\n  geom_jitter(width = 0.1, alpha = 0.2) +\n  facet_wrap(~exp) +\n  theme_bw() +\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5,\n               color = \"black\") +\n  geom_smooth(method = \"lm\", se = F)\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nexp2 <- estande |>\n  filter (exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants)) +\n  geom_point() +\n  ylim(0,100) +\n  geom_smooth(method = \"lm\", se = F, formula = y ~poly(x,2), color = \"black\") +\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#MODELO LINEAR\n\nexp2$trat2 <- exp2$trat^2\n\n#primeira ordem\nlm2 <- lm(nplants ~ trat, \n          data = exp2)\nsummary(lm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat, data = exp2)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-25.7816  -7.7150   0.5653   8.1929  19.2184 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  60.9857     3.6304  16.798 4.93e-14 ***\ntrat         -0.7007     0.1605  -4.365 0.000247 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.95 on 22 degrees of freedom\nMultiple R-squared:  0.4641,\tAdjusted R-squared:  0.4398 \nF-statistic: 19.05 on 1 and 22 DF,  p-value: 0.0002473\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(residuals(lm2))\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#segunda ordem\n\nlm3 <- lm(nplants ~ trat + trat2, \n          data = exp2)\nsummary(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = nplants ~ trat + trat2, data = exp2)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-25.439  -6.019   1.789   8.016  19.561 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 66.30156    4.42097  14.997 1.08e-12 ***\ntrat        -1.77720    0.58467  -3.040  0.00623 ** \ntrat2        0.02223    0.01166   1.906  0.07036 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 12.24 on 21 degrees of freedom\nMultiple R-squared:  0.5432,\tAdjusted R-squared:  0.4997 \nF-statistic: 12.49 on 2 and 21 DF,  p-value: 0.0002675\n```\n\n\n:::\n\n```{.r .cell-code}\nhist(residuals(lm3))\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n\n```{.r .cell-code}\nAIC(lm2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 194.9597\n```\n\n\n:::\n\n```{.r .cell-code}\nAIC(lm3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 193.1284\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(AgroR)\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n----------------------------------------------------\nRegression Models\n----------------------------------------------------\n                Estimate  Std. Error   t value     Pr(>|t|)\n(Intercept) 70.265143802 5.300440019 13.256474 2.295186e-11\ntrat        -3.609380523 1.514625525 -2.383018 2.720299e-02\nI(trat^2)    0.140522077 0.091192577  1.540938 1.390058e-01\nI(trat^3)   -0.001712445 0.001309648 -1.307561 2.058546e-01\n\n----------------------------------------------------\nDeviations from regression\n----------------------------------------------------\n          Df       SSq       MSQ          F      p-value\nLinear     1 3196.2031 3196.2031 21.8232929 0.0001899378\nQuadratic  1  544.5029  544.5029  3.7178008 0.0697619482\nCubic      1  247.7520  247.7520  1.6916208 0.2097934169\nDeviation  2  261.9170  130.9585  0.8941691 0.4263523326\nResidual  18 2636.2500  146.4583                        \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-5-6.png){width=672}\n:::\n\n```{.r .cell-code}\n#library(agro3)\n#data(\"phao\")\n#with(phao, polynomial(dose, comp, grau = 2))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\") \n\nlibrary(tidyverse)\n\npyra |>\n  group_by(code, dose) |>\n  summarise(mean_germination = mean(germination)) |> \n  ggplot(aes(dose, mean_germination)) +\n  geom_point() +\n  facet_wrap(~code) +\n  labs(y = \"Germination\",\n         x = \"Dose\")\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\npyra2 <- pyra |>\n  group_by(code, dose) |>\n  summarise(mean_germination = mean(germination)) \n \nlibrary(drc)\n\nisolado186 <- pyra2 |>\n  filter(code == \"186\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado186,\n            fct = LL.3())\nAIC(drc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 21.11219\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(drc1)\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\nED(drc1, 50, interval = \"delta\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nEstimated effective doses\n\n       Estimate Std. Error    Lower    Upper\ne:1:50 0.579757   0.013332 0.537328 0.622187\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(drc1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nModel fitted: Log-logistic (ED50 as parameter) with lower limit at 0 (3 parms)\n\nParameter estimates:\n\n               Estimate Std. Error t-value   p-value    \nb:(Intercept)  4.997636   0.542650  9.2097  0.002708 ** \nd:(Intercept) 48.750109   0.721642 67.5545 7.148e-06 ***\ne:(Intercept)  0.579757   0.013332 43.4853 2.677e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error:\n\n 1.020525 (3 degrees of freedom)\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ec50estimator)\n\n\ndf_ec50 <- estimate_EC50(mean_germination ~ dose, \n                         data = pyra2, \n                         isolate_col = \"code\",\n                         interval = \"delta\", \n                         fct = drc::LL.3())\n\ndf_ec50 |>\n  ggplot(aes(reorder(ID, Estimate), Estimate)) +\n  geom_point() +\n  geom_errorbar(aes(ymin = Lower, ymax= Upper), width = 0.1) +\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(ec50estimator) #Permite estimar o ec50 de todos os isolados ao mesmo tempo\ndf_ec50 <- estimate_EC50(mean_germination ~ dose,\n                         data = pyra2,\n                         isolate_col = \"code\",\n                         interval = \"delta\",\n                         fct = drc::LL.3())\ndf_ec50\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      ID strata   Estimate  Std..Error        Lower     Upper\n1    152        0.44435629 0.077789240  0.196796213 0.6919164\n2    153        0.20379664 0.042373512  0.068945217 0.3386481\n3    164        0.50775844 0.047248266  0.357393370 0.6581235\n4    165        0.55839613 0.114195113  0.194976315 0.9218159\n5    169        0.14722311 0.009555688  0.116812646 0.1776336\n6    170        0.37503889 0.043207328  0.237533889 0.5125439\n7    186        0.57975744 0.013332268  0.537328208 0.6221867\n8    187        0.21563338 0.036639446  0.099030315 0.3322365\n9    188        0.15297172 0.004284691  0.139335920 0.1666075\n10   189        0.53106193 0.023130936  0.457448972 0.6046749\n11 FGT05        0.04483862 0.019290890 -0.016553601 0.1062308\n12 FGT06        0.54497946 0.034834602  0.434120211 0.6558387\n13 FGT07        0.88770053 0.079917704  0.633366725 1.1420343\n14 FGT28        0.22608141 0.033600742  0.119148854 0.3330140\n15 FGT29        0.23601652 0.034933881  0.124841318 0.3471917\n16 FGT33        0.10481627 0.013065221  0.063236910 0.1463956\n17 FGT34        0.14773114 0.047003373 -0.001854568 0.2973169\n18 FGT35        0.20315392 0.038984604  0.079087515 0.3272203\n19 FGT42        0.45000559 0.059685890  0.260058448 0.6399527\n20 FGT43        0.49589549 0.060850771  0.302241178 0.6895498\n```\n\n\n:::\n\n```{.r .cell-code}\n#Se a ec50 for maior, menos sensível é o isolado (nesse caso ao fungicida)\n\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate))+\n  geom_point()+\n  geom_errorbar(aes(ymin = Lower, ymax = Upper))+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](aula10_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}